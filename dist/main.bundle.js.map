{"version":3,"file":"main.bundle.js","mappings":"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","sources":["webpack://p2d-ts/./src/manifold.ts","webpack://p2d-ts/./src/shape.ts","webpack://p2d-ts/./src/vec2.ts","webpack://p2d-ts/./src/world.ts","webpack://p2d-ts/webpack/bootstrap","webpack://p2d-ts/webpack/runtime/define property getters","webpack://p2d-ts/webpack/runtime/hasOwnProperty shorthand","webpack://p2d-ts/webpack/runtime/make namespace object","webpack://p2d-ts/./src/main.ts"],"sourcesContent":["import { Body } from \"./body\";\nimport { Circle, ShapeType } from \"./shape\";\nimport { Vec2 } from \"./vec2\";\n\ntype DispatchFunction = (m: Manifold, a: Body, b: Body) => void;\nconst DISPATCHER: Map<ShapeType, Map<ShapeType, DispatchFunction>> = new Map([\n  [\n    ShapeType.Circle,\n    new Map([\n      [ShapeType.Circle, circle2circle],\n      [ShapeType.AABB, circle2AABB],\n    ]),\n  ],\n  [\n    ShapeType.AABB,\n    new Map([\n      [ShapeType.Circle, AABB2circle],\n      [ShapeType.AABB, AABB2AABB],\n    ]),\n  ],\n]);\n\nexport class Manifold {\n  a: Body;\n  b: Body;\n\n  normal: Vec2 = new Vec2(0, 1); // 单位向量，碰撞法线，表明两个物体的碰撞方向，在我们的物理引擎中采用相对于 B 的碰撞方向\n  penetration: number = 0;\n  e: number = 0; // 计算后的恢复系数\n  contacts: Array<Vec2> = []; // 碰撞发生的位置\n\n  constructor(a: Body, b: Body) {\n    this.a = a;\n    this.b = b;\n  }\n\n  // 生成碰撞信息\n  solve() {\n    const func = DISPATCHER.get(this.a.shape.shapeType)?.get(\n      this.b.shape.shapeType\n    );\n    if (func) {\n      func(this, this.a, this.b);\n    } else {\n      throw Error(\"Invalid shape type\");\n    }\n  }\n\n  // 计算一些冲量求解的过程中需要的数据\n  initialize() {\n    this.e = Math.min(this.a.restitution, this.b.restitution);\n  }\n\n  applyImpulse() {\n    if (Math.abs(this.a.inverse_mass + this.b.inverse_mass) < 0.00001) {\n      // 两个物体的质量都无穷大\n      this.infiniteMassCorrection();\n      return;\n    }\n    // for (const contanct of this.contacts) {\n    // 相对速度在碰撞法线方向的分量\n    const rv = Vec2.dot(\n      Vec2.sub(this.b.velocity, this.a.velocity),\n      this.normal\n    );\n    if (rv > 0) {\n      // 物体有分离的趋势\n      return;\n    }\n    const inv_mass_sum = this.a.inverse_mass + this.b.inverse_mass;\n    // 计算冲量\n    let j = -(1.0 + this.e) * rv;\n    j /= inv_mass_sum;\n\n    const impulse = Vec2.product(this.normal, j);\n    this.a.applyImpulse(Vec2.minus(impulse));\n    this.b.applyImpulse(impulse);\n    // }\n  }\n\n  positionalCorrection() {\n    const kSlop = 0.05; // Penetration allowance\n    const percent = 0.4; // Penetration percentage to correct\n    const correction = Vec2.product(this.normal, (Math.max( this.penetration - kSlop, 0 ) / (this.a.inverse_mass + this.b.inverse_mass)) * percent);\n    this.a.position = Vec2.add(this.a.position, Vec2.product(correction, this.a.inverse_mass));\n    this.b.position = Vec2.add(this.b.position, Vec2.product(correction, this.b.inverse_mass));\n  }\n\n  private infiniteMassCorrection() {\n    this.a.velocity = new Vec2(0, 0);\n    this.b.velocity = new Vec2(0, 0);\n  }\n}\n\nfunction circle2circle(m: Manifold, a: Body, b: Body) {\n  const circleA = a.shape as Circle;\n  const circleB = b.shape as Circle;\n  const n = Vec2.sub(b.position, a.position);\n  const r = circleA.getRadius() + circleB.getRadius();\n  const dist_sqr = n.lenSqr();\n  if (dist_sqr >= r) {\n    // 无碰撞发生\n    return;\n  }\n  const dist = Math.sqrt(dist_sqr);\n  if (dist === 0) {\n    // 两个圆处于同一位置\n    m.penetration = circleA.getRadius();\n    m.normal = new Vec2(1, 0);\n    m.contacts.push(a.position);\n  } else {\n    m.penetration = r - dist;\n    m.normal = Vec2.div(n, dist);\n    // 相对于 A 来说的碰撞点位置\n    m.contacts.push(\n      Vec2.add(Vec2.product(m.normal, circleA.getRadius()), a.position)\n    );\n  }\n}\nfunction circle2AABB(m: Manifold, a: Body, b: Body) {}\nfunction AABB2AABB(m: Manifold, a: Body, b: Body) {}\nfunction AABB2circle(m: Manifold, a: Body, b: Body) {}\n","export enum ShapeType {\n  Circle,\n  AABB,\n}\n\nexport interface Shape {\n    readonly shapeType: ShapeType;\n    computeMass: () => number;\n}\n\nexport class Circle implements Shape {\n    private radius: number;\n    shapeType: ShapeType = ShapeType.Circle;\n    private density = 1.0;\n\n    constructor(radius: number) {\n        this.radius = radius;\n    }\n\n    computeMass() {\n        return Math.PI * Math.pow(this.radius, 2) * this.density;\n    }\n\n    getRadius() {\n        return this.radius;\n    }\n}\n","export class Vec2 {\n  public x: number;\n  public y: number;\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n\n  static add(left: Vec2, right: number): Vec2;\n  static add(left: Vec2, right: Vec2): Vec2;\n  static add(left: Vec2, right: number | Vec2): Vec2 {\n    if (typeof right === \"number\") {\n      return new Vec2(left.x + right, left.y + right);\n    } else {\n      return new Vec2(left.x + right.x, left.y + right.y);\n    }\n  }\n\n  static sub(left: Vec2, right: number): Vec2;\n  static sub(left: Vec2, right: Vec2): Vec2;\n  static sub(left: Vec2, right: number | Vec2): Vec2 {\n    if (typeof right === \"number\") {\n      return new Vec2(left.x - right, left.y - right);\n    } else {\n      return new Vec2(left.x - right.x, left.y - right.y);\n    }\n  }\n\n  static product(left: Vec2, right: number): Vec2 {\n    return new Vec2(left.x * right, left.y * right);\n  }\n\n  static dot(left: Vec2, right: Vec2): number {\n    return left.x * right.x + left.y * right.y;\n  }\n\n  static div(left: Vec2, right: number): Vec2 {\n    return new Vec2(left.x / right, left.y / right);\n  }\n\n  private static clampNumber(value: number, min: number, max: number) {\n    if (value < min) {\n      return min;\n    } else if (value > max) {\n      return max;\n    }\n    return value;\n  }\n\n  static clamp(value: Vec2, min: Vec2, max: Vec2) {\n    return new Vec2(\n      Vec2.clampNumber(value.x, min.x, max.x),\n      Vec2.clampNumber(value.y, min.y, max.y)\n    );\n  }\n\n  static minus(vec: Vec2) {\n    return new Vec2(-vec.x, -vec.y);\n  }\n\n  normalize() {\n    const length = this.distance();\n    this.x /= length;\n    this.y /= length;\n  }\n\n  lenSqr(): number {\n    return this.x * this.x + this.y + this.y;\n  }\n\n  distance() {\n    return Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2));\n  }\n}\n","import { Body } from \"./body\";\nimport { Manifold } from \"./manifold\";\nimport { Vec2 } from \"./vec2\";\n\nexport class World {\n  private dt: number;\n  private iterations: number;\n  private bodies: Array<Body> = [];\n  private contacts: Array<Manifold> = [];\n  private gravity = new Vec2(0, 10.0);\n\n  constructor(dt: number, iterations: number) {\n    this.dt = dt;\n    this.iterations = iterations;\n  }\n\n  step() {\n    this.contacts.length = 0;\n    // 碰撞检测\n    for (let i = 0; i < this.bodies.length; ++i) {\n      const a = this.bodies[i];\n      for (let j = i + 1; j < this.bodies.length; ++j) {\n        const b = this.bodies[j];\n        if (a.inverse_mass === 0 && b.inverse_mass === 0) {\n          // 两个物体的质量都是无穷大，都不会挪动了\n          continue;\n        }\n        const m = new Manifold(a, b);\n        m.solve();\n        if (m.contacts.length > 0) {\n          this.contacts.push(m);\n        }\n      }\n    }\n\n    for (let i = 0; i < this.bodies.length; ++i) {\n      this.integrateForces(this.bodies[i], this.dt);\n    }\n\n    for (let i = 0; i < this.contacts.length; ++i) {\n      this.contacts[i].initialize();\n    }\n\n    for (let j = 0; j < this.iterations; ++j) {\n      for (let i = 0; i < this.contacts.length; ++i) {\n        this.contacts[i].applyImpulse();\n      }\n    }\n\n    for (const body of this.bodies) {\n      this.integrateVelocity(body, this.dt);\n    }\n\n    // 校正位置\n    for (const contact of this.contacts) {\n      contact.positionalCorrection();\n    }\n\n    // 清除所有受力\n    for (const body of this.bodies) {\n      body.force = new Vec2(0, 0);\n    }\n  }\n\n  add(body: Body) {\n    this.bodies.push(body);\n  }\n\n  private integrateForces(body: Body, dt: number) {\n    if (body.inverse_mass === 0) {\n      return;\n    }\n\n    body.velocity = Vec2.add(\n      body.velocity,\n      Vec2.product(\n        Vec2.add(Vec2.product(body.force, body.inverse_mass), this.gravity),\n        dt / 2\n      )\n    );\n  }\n\n  private integrateVelocity(body: Body, dt: number) {\n    if (body.inverse_mass === 0) {\n      return;\n    }\n    body.position = Vec2.add(body.position, Vec2.product(body.velocity, dt));\n    // TODO: Why ??\n    this.integrateForces(body, dt);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { World } from \"./world\";\n\nconst canvas = document.querySelector(\".scene\") as HTMLCanvasElement;\ncanvas.width = 480;\ncanvas.height = 800;\n\nconst world = new World(1 / 60, 10);\n\nconst renderLoop = () => {\n    world.step();\n    requestAnimationFrame(renderLoop);\n};\n\nrenderLoop();\n"],"names":[],"sourceRoot":""}